{% load server2ipv4addr %}
#######################################################
#        eduroam TLR CLIENT and SERVER BLOCKS         #
####################################################### 

{% for server in tlrservers %}
client {{ server.name }} {
     type UDP
     host {{ server.host|server2ipv4addr:server_addr }}
     secret {{ server.secret }}
}

server {{ server.name }} {
    type UDP
    host {{ server.host|server2ipv4addr:server_addr }}
    {% spaceless %}
    {% if server.auth_port != '1812' %}
    port {{ server.auth_port }}
    {% endif %}
    {% endspaceless %}
    secret {{ server.secret }}
    statusserver {{ server.status_server|yesno:"On,Off" }}
}

{% endfor %}

### eduroam monitoring ###

client {{ confparams.mon_host }} {
    host {{ confparams.mon_host }}
    type udp
    secret {{ confparams.mon_secret }}
}

client SA5-monitoring-incoming {
    host {{ confparams.sa_5_incoming_host }}
    type udp
    secret {{ confparams.sa_5_incoming_secret }}
}

client SA5-monitoring-outgoing {
    host {{ confparams.sa_5_outgoing_host }}
    type udp
    secret {{ confparams.sa_5_outgoing_secret }}
}

### Other realms ###

realm /eduroam\.{{ confparams.tld }}/ {
    server SA5-monitoring-outgoing
    #server TODO:SRCE RadSec server
}

realm /\.{{ confparams.tld }}$/ {
    replymessage "Misconfigured supplicant or downstream server: uses unknown realm in this federation!"
}

#######################################################
#                  TLR REALM BLOCK                    #
#######################################################

# DEFAULT forwarding: to the Top-Level Servers
realm /@.+\..{2,}$/ {
    {% for server in tlrservers %}
    server {{ server.name }}
    {% endfor %}
}

realm * {
    replymessage "Misconfigured client: username does not contain a valid realm!"
}
